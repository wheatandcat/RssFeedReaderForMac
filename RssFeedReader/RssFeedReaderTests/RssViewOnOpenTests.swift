@testable import RssFeedReader
import Foundation
import Testing

/// Task 4.1: RssView の onOpen コールバックシグネチャ検証
/// onOpen が FeedItem を受け取ることを型レベルで保証する
struct RssViewOnOpenTests {
    @Test func rssViewInitializesWithOnOpenCallback() {
        var openedItem: FeedItem?

        let view = RssView(
            feeds: [],
            items: [],
            reload: {},
            onOpen: { item in openedItem = item }
        )

        // View が正常に構築される（コンパイル時型検証）
        let _ = view
        #expect(openedItem == nil)
    }

    @Test func onOpenCallbackReceivesFeedItem() {
        let expectedItem = FeedItem(
            title: "テスト記事",
            link: "https://example.com/test",
            siteTitle: "Test Feed"
        )
        var receivedItem: FeedItem?

        let onOpen: (FeedItem) -> Void = { item in
            receivedItem = item
        }

        // コールバックのシグネチャが FeedItem を受け取ることを直接確認
        onOpen(expectedItem)
        #expect(receivedItem?.title == "テスト記事")
        #expect(receivedItem?.link == "https://example.com/test")
    }
}
